<!DOCTYPE html>
<html>
<head>
	<title>321 to 123</title>
	<meta charset="utf-8">
</head>
<body>
	<div>
		<div id='messageboard' >123</div>
		<div id=board>
			<form>
				<input type="text">
				<input type="button" onclick="submitmessage()" value="Send">
			</form>
			<p id="statusbar"></p>
		</div>
	</div>

	<style>
		* {padding: 0;}
		body>div:first-child { min-width:460px; max-width: 500px; margin: 0 auto; padding:15px 0; background-color:gray;
		border-radius: 5px; }

		#messageboard { border:1px solid ;max-width:483px ; min-height: 380px; margin: 0 15px;  background-color: white; padding: 6px; overflow-y:  scroll; }
	
		#board form { max-width:483px ; height: 60px; margin:3px 15px; }
		#board form input:first-child { width: 80%; height: 56px; font-size: 1.5em; vertical-align: top; } /* "vertical-align: top" */
		#board form input:last-child { width: 81px; height: 60px; border-radius: 8px; }

		#statusbar { font-size: 0.5em; height: 0.6em; margin: 0; margin-left: 15px; }
	</style>

	<script >
		//initial..
		var messageboard = document.getElementById("messageboard");
		var statusbar = document.getElementById('statusbar');
	//	var messagenumber = 0 ;
		var createNewP = function( evt){
			var p = document.createElement('p');
			p.style.wordWrap = 'break-word';
			p.style.maxWidth = '80%';
			p.style.backgroundColor = 'gray';
			p.innerText = ''+ evt.data;
			messageboard.appendChild(p);
		};

		//start..
		var username;
		while( username == undefined || ''){
			username = window.prompt('取个名字');
		};

		//connecting..
		statusbar.innerHTML ='<span">正在连接服务器..</span>'

		var ws = new WebSocket("ws://localhost:8080/echo");
		ws.onopen = function(){
			statusbar.innerHTML ='<span style="color:blue;">连接服务器成功 !</span>'
			ws.send(username);

		};
		ws.onmessage = function(evt){
			createNewP( evt );
			statusbar.innerHTML ='<span style="color:blue;">收到新消息</span>'
		};
		ws.onclose = function(evt){
			statusbar.innerHTML ='<span style="color:red;">与服务器断开了连接! 请刷新页面</span>'
		};
		ws.onerror = function(){
			statusbar.innerHTML ='<span style="color:red;">连接失败 !</span>'
		}

		//on submit sendmessage
		function submitmessage (){
			statusbar.innerHTML ='<span>正在发送消息..</span>';

			var message = document.getElementsByTagName('input')[0].value;
			document.getElementsByTagName('input')[0].value="";
			ws.send(message)
		};

		//statubar clear read message 
		document.getElementsByTagName('input')[0].onfocus = function(){ statusbar.innerHTML ='' }

	</script>
</body>
</html>